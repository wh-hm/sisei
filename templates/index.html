<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ポーズ判定</title>
<style>
#container { display: flex; gap: 20px; }
#videoElement { border: 1px solid #ccc; }
#resultImg { border: 1px solid #ccc; }
</style>
</head>
<body>

<h2>ライブカメラ or 画像アップロードで解析</h2>
<div id="container">
    <div>
        <video id="videoElement" width="320" height="240" autoplay></video>
        <br>
        <button onclick="captureFromCamera()">ライブ取得</button>
        <br><br>
        <input type="file" id="uploadImage" accept="image/*">
        <button onclick="analyzeUpload()">静止画解析</button>
    </div>
    <div>
        <img id="resultImg" width="320" height="240">
        <p id="scoreText"></p>
    </div>
</div>

<script>
const video = document.getElementById('videoElement');
navigator.mediaDevices.getUserMedia({video: true})
.then(stream => { video.srcObject = stream; })
.catch(err => { console.error(err); });

function captureFromCamera(){
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0);
    sendImage(canvas.toDataURL());
}

function analyzeUpload(){
    const file = document.getElementById('uploadImage').files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = e => sendImage(e.target.result);
    reader.readAsDataURL(file);
}

function sendImage(imgData){
    fetch("/analyze", {
        method:"POST",
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({image: imgData})
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById('resultImg').src = data.result;
        document.getElementById('scoreText').innerText = "ゴールデンラインスコア: " + data.score.toFixed(1) + "%";
    });
}
</script>

</body>
</html>
